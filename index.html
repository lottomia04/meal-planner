<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meal Planner</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .hidden {
            display: none;
        }
        button {
            padding: 10px;
            margin: 5px;
            cursor: pointer;
        }
        #login, #mealPlanner {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div id="login">
        <h1>Login</h1>
        <input type="text" id="username" placeholder="Username" required><br>
        <input type="password" id="password" placeholder="Password" required><br>
        <button id="loginButton">Login</button>
        <button id="signupButton">Create Account</button>
    </div>

    <div id="mealPlanner" class="hidden">
        <h1>Welcome, <span id="userDisplay"></span></h1>
        <h2>Meal Log</h2>
        <div id="mealLog"></div>

        <h3>Add Meal</h3>
        <input type="text" id="mealName" placeholder="Meal Name" required><br>
        <input type="text" id="mealIngredients" placeholder="Ingredients (comma separated)" required><br>
        <button id="addMealButton">Add Meal</button>

        <h3>Shopping List</h3>
        <div id="shoppingList"></div>
        <button id="clearListButton">Clear Shopping List</button>
        <button id="logoutButton">Logout</button>
    </div>

    <script>
        // Check if user is logged in and load data
        let currentUser = null;

        const users = JSON.parse(localStorage.getItem('users')) || {};

        function loadUserData() {
            if (currentUser && users[currentUser]) {
                const user = users[currentUser];
                document.getElementById('userDisplay').textContent = currentUser;
                renderMealLog(user);
                renderShoppingList(user);
            }
        }

        // Login functionality
        document.getElementById('loginButton').addEventListener('click', () => {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            if (users[username] && users[username].password === password) {
                currentUser = username;
                document.getElementById('login').classList.add('hidden');
                document.getElementById('mealPlanner').classList.remove('hidden');
                loadUserData();
            } else {
                alert('Invalid username or password');
            }
        });

        // Sign-up functionality
        document.getElementById('signupButton').addEventListener('click', () => {
            const username = prompt('Enter your desired username');
            const password = prompt('Enter your password');

            if (username && password) {
                users[username] = { password, meals: [], shoppingList: [] };
                localStorage.setItem('users', JSON.stringify(users));
                alert('Account created successfully! Please log in.');
            }
        });

        // Add meal to the log
        document.getElementById('addMealButton').addEventListener('click', () => {
            const mealName = document.getElementById('mealName').value;
            const mealIngredients = document.getElementById('mealIngredients').value.split(',');

            if (!mealName || mealIngredients.length === 0) {
                alert('Please provide both meal name and ingredients.');
                return;
            }

            if (currentUser) {
                const user = users[currentUser];
                const meal = { name: mealName, ingredients: mealIngredients };

                user.meals.push(meal);
                localStorage.setItem('users', JSON.stringify(users));

                renderMealLog(user);
                document.getElementById('mealName').value = '';
                document.getElementById('mealIngredients').value = '';
            }
        });

        // Render meal log
        function renderMealLog(user) {
            const mealLogDiv = document.getElementById('mealLog');
            mealLogDiv.innerHTML = '';

            user.meals.forEach((meal, index) => {
                const mealButton = document.createElement('button');
                mealButton.textContent = meal.name;
                mealButton.addEventListener('click', () => addToShoppingList(meal));
                const deleteButton = document.createElement('button');
                deleteButton.textContent = 'Delete';
                deleteButton.addEventListener('click', () => deleteMeal(user, index));

                const mealDiv = document.createElement('div');
                mealDiv.appendChild(mealButton);
                mealDiv.appendChild(deleteButton);
                mealLogDiv.appendChild(mealDiv);
            });
        }

        // Add ingredients to shopping list
        function addToShoppingList(meal) {
            const user = users[currentUser];
            meal.ingredients.forEach(ingredient => {
                if (!user.shoppingList.includes(ingredient.trim())) {
                    user.shoppingList.push(ingredient.trim());
                }
            });
            localStorage.setItem('users', JSON.stringify(users));
            renderShoppingList(user);
        }

        // Render shopping list
        function renderShoppingList(user) {
            const shoppingListDiv = document.getElementById('shoppingList');
            shoppingListDiv.innerHTML = '';
            user.shoppingList.forEach(item => {
                const listItem = document.createElement('div');
                listItem.textContent = item;
                shoppingListDiv.appendChild(listItem);
            });
        }

        // Clear shopping list
        document.getElementById('clearListButton').addEventListener('click', () => {
            if (currentUser) {
                const user = users[currentUser];
                user.shoppingList = [];
                localStorage.setItem('users', JSON.stringify(users));
                renderShoppingList(user);
            }
        });

        // Delete meal from log
        function deleteMeal(user, index) {
            user.meals.splice(index, 1);
            localStorage.setItem('users', JSON.stringify(users));
            renderMealLog(user);
            renderShoppingList(user);
        }

        // Logout functionality
        document.getElementById('logoutButton').addEventListener('click', () => {
            currentUser = null;
            document.getElementById('login').classList.remove('hidden');
            document.getElementById('mealPlanner').classList.add('hidden');
        });
    </script>
</body>
</html>

